---

## Section 7: Best Practices for Projections and Predicates

As your SQL queries become more complex — especially when joining multiple
tables and using aggregation — it becomes important to write queries that are
clear, efficient, and correct.

This section focuses on two key concepts that improve SQL readability and
performance:

* **Projections**: Which columns you choose to include
* **Predicates**: Which rows you choose to include

Understanding the difference (and how they interact) will help you write
cleaner, faster, and more purposeful queries.

---

### 1. What Is a Projection?

In SQL, the **projection** is the part of the query that specifies **which
columns** to include in the result. It’s the `SELECT` clause.

**Example:**

```sql
SELECT students.name, courses.title
```

You're projecting (selecting) just two specific columns instead of dumping all
data with `SELECT *`.

**Why it matters:**

* Reduces clutter in the output
* Improves query performance
* Makes code more readable
* Prevents accidental name collisions

---

### 2. What Is a Predicate?

A **predicate** is a condition that filters rows — found in `WHERE` or `HAVING`
clauses.

**Examples:**

```sql
WHERE grade_level = 11
HAVING COUNT(*) > 1
```

Predicates determine **which rows** are included before or after aggregation:

* Use `WHERE` to filter **before** grouping
* Use `HAVING` to filter **after** grouping

---

### 3. Combine Projections and Predicates Thoughtfully

Here’s a cleanly structured query:

```sql
SELECT courses.title, COUNT(enrollments.student_id) AS num_students
FROM courses
LEFT JOIN enrollments ON courses.id = enrollments.course_id
WHERE courses.subject = 'Science'
GROUP BY courses.title
HAVING num_students >= 2;
```

* **Projection**: `title`, `num_students`
* **Predicates**:

  * `WHERE` limits input to only science courses
  * `HAVING` ensures we only show courses with 2+ students

Keeping these separate makes the logic easier to follow.

---

### 4. Avoid Common Mistakes

| Mistake                                                    | Fix                                                               |
| ---------------------------------------------------------- | ----------------------------------------------------------------- |
| Using `SELECT *` in multi-table joins                      | Always specify only the needed columns                            |
| Filtering aggregates with `WHERE`                          | Use `HAVING` for anything that relies on `COUNT()`, `SUM()`, etc. |
| Forgetting `GROUP BY` when selecting non-aggregated fields | Group by all non-aggregated columns in your `SELECT` clause       |

---

### 5. Summary

* **Projection = columns**
* **Predicate = filters**
* Keep your `SELECT`, `WHERE`, `GROUP BY`, and `HAVING` clauses purposeful and
  separate
* Write queries that are easy to understand at a glance

---

> **Helpful Hint:**
> When debugging a join-heavy SQL query, start by removing the `WHERE` and
> `HAVING` clauses. See what the raw joined data looks like first — then add
> filters back in one at a time.

